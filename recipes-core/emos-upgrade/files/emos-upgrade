#!/bin/sh

#
# Copyright (C) 2018, TQ Systems
#

set -e


usage() {
	echo >&2 "Usage: emos-upgrade install BUNDLE"
	exit 1
}

cmd_install() {
	[ $# -eq 1 -a -e "$1" ] || usage

	emos-upgrade-status set_status update_1_started
	rauc install "$1"
	mv "$1" /update/last-upgrade.raucb
	emos-upgrade-status set_status update_1_finished
	reboot
}


CMD="$1"; shift

case "$CMD" in
install)
	cmd_$CMD "$@"
	;;

*)
	usage
esac
